<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <title>Display Informasi Digital Tjahaja Baru</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
        }

        #slidesFrame {
            width: 100%;
            height: calc(100vh - 60px);
            border: none;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #loadingScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 10000;
            font-family: Arial, sans-serif;
        }

        .loader {
            width: 40px;
            aspect-ratio: 1;
            --c: linear-gradient(#000 0 0);
            --m: radial-gradient(farthest-side,#000 92%,#0000);
            background: 
                var(--c),var(--m),
                var(--c),var(--m), 
                var(--c),var(--m);
            background-size: 8px 12px,8px 8px;
            background-repeat: no-repeat;
            animation: l17 1s infinite linear;
        }

        @keyframes l17 {
            0%,5% {background-position: 0 50%, 0 0, 50% 50%, 50% 0, 100% 50%, 100% 0}
            12.5% {background-position: 0 50%, 0 calc(50% - 10px), 50% 50%, 50% 0, 100% 50%, 100% 0}
            25%   {background-position: 0 calc(50% + 10px), 0 50%, 50% 50%, 50% 0, 100% 50%, 100% 0}
            37.5% {background-position: 0 calc(50% + 10px), 0 50%, 50% 50%, 50% calc(50% - 10px), 100% 50%, 100% 0}
            50%   {background-position: 0 50%, 0 0, 50% 50%, 50% 0, 100% 50%, 100% 0}
            62.5% {background-position: 0 50%, 0 0, 50% calc(50% + 10px), 50% 50%, 100% 50%, 100% calc(50% - 10px)}
            75%   {background-position: 0 50%, 0 0, 50% 50%, 50% 0, 100% calc(50 + 10px), 100% 50%}
            87.5% {background-position: 0 50%, 0 0, 50% 50%, 50% 0, 100% calc(50 + 10px), 100% 50%}
            95%, 100%  {background-position: 0 50%, 0 0, 50% 50%, 50% 0, 100% 50%, 100% 0}
        }

        .title {
            font-weight: bold;
            font-size: 36px;
            color: #041066;
            margin-top: 20px;
        }

        #footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(240,245,255,0.98) 100%);
            color: #041066;
            display: flex;
            align-items: center;
            overflow: hidden;
            border-top: 3px solid #041066;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            height: 60px;
            z-index: 999;
            box-shadow: 0 -4px 20px rgba(4,16,102,0.15);
            backdrop-filter: blur(10px);
        }

        #timeDisplay {
            padding: 0 25px;
            white-space: nowrap;
            font-weight: 700;
            font-size: 18px;
            background: linear-gradient(135deg, #041066 0%, #062080 100%);
            color: white;
            height: 100%;
            display: flex;
            align-items: center;
            min-width: 380px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .marquee-container {
            flex: 1;
            overflow: hidden;
            position: relative;
            height: 100%;
        }

        .marquee {
            display: inline-block;
            white-space: nowrap;
            font-size: 22px;
            font-weight: 600;
            line-height: 60px;
            position: absolute;
            color: #041066;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            opacity: 0;
            will-change: transform;
        }

        .breaking {
            background: linear-gradient(90deg, #ff0000, #cc0000);
            color: white !important;
            padding: 0 20px;
            animation: flash 1.5s infinite;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .new-badge {
            background: #ff8c00;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 900;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .category-icon {
            font-size: 28px;
            margin: 0 12px;
            display: inline-block;
        }

        .progress-container {
            position: absolute;
            bottom: 0;
            left: 380px;
            right: 0;
            height: 3px;
            background: rgba(4,16,102,0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff8c00, #ff6b00);
            width: 0%;
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(255,140,0,0.5);
        }

        /* ANIMASI SMOOTH LINEAR - SEPERTI TV - TIDAK NGEBUT */
        @keyframes scrollSmooth {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            95% {
                opacity: 1;
            }
            100% {
                transform: translateX(-100%);
                opacity: 0;
            }
        }

        /* ANIMASI DENGAN PAUSE DI TENGAH - SANTAI */
        @keyframes scrollWithPause {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }
            8% {
                opacity: 1;
            }
            48% {
                transform: translateX(10%);
            }
            52% {
                transform: translateX(10%);
            }
            92% {
                opacity: 1;
            }
            100% {
                transform: translateX(-100%);
                opacity: 0;
            }
        }

        .highlight-promo {
            color: #ff0000;
            font-weight: 900;
            font-size: 1.1em;
            text-shadow: 3px 3px 6px rgba(255,0,0,0.3);
        }

        .highlight-number {
            color: #ff8c00;
            font-weight: 900;
            font-size: 1.15em;
        }
    </style>
</head>
<body>

    <div id="loadingScreen">
        <div class="loader"></div>
        <div class="title">TJAHAJA BARU</div>
    </div>

    <iframe id="slidesFrame" 
            src="https://docs.google.com/presentation/d/e/2PACX-1vSQ38LjFgAHXbNbfC4gkaOTJsLCCny4BZhxZ3ttF_mD74Onq800eqQhN7pqHnr6fgexDu8dSJv1Fl1d/embed?start=true&loop=true&delayms=30000" 
            allowfullscreen="true">
    </iframe>

    <div id="footer">
        <div id="timeDisplay">00:00:00</div>
        <div class="marquee-container">
            <div id="marqueeText" class="marquee">Memuat informasi...</div>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
    </div>

    <script>
        // URL APPS SCRIPT
        const API_URL = 'https://script.google.com/macros/s/AKfycbynDFVmfgnZv_5D65NS4qniSS24ygJ9L8xEFwE3S0EOqx1wJg0bgD8R_xUNefxIWQTTuw/exec';
        
        const iframe = document.getElementById("slidesFrame");
        const loadingScreen = document.getElementById("loadingScreen");
        const marqueeText = document.getElementById("marqueeText");
        const timeDisplay = document.getElementById("timeDisplay");
        const progressBar = document.getElementById("progressBar");

        let currentTextIndex = 0;
        let runningTexts = [];
        let isAnimating = false;
        let scrollSpeed = 25; // Default 25 detik (santai)
        let reloadInterval = 60;
        let progressInterval;

        const categoryIcons = {
            'service': 'üîß',
            'promo': 'üí∞',
            'diskon': 'üè∑Ô∏è',
            'event': 'üéâ',
            'info': '‚ÑπÔ∏è',
            'yamaha': 'üèçÔ∏è',
            'nmax': 'üèçÔ∏è',
            'default': 'üèçÔ∏è'
        };

        function detectCategory(text) {
            const lower = text.toLowerCase();
            if (lower.includes('service') || lower.includes('servis')) return 'service';
            if (lower.includes('promo')) return 'promo';
            if (lower.includes('diskon') || lower.includes('discount')) return 'diskon';
            if (lower.includes('event') || lower.includes('acara')) return 'event';
            if (lower.includes('nmax')) return 'nmax';
            if (lower.includes('yamaha')) return 'yamaha';
            return 'default';
        }

        function highlightText(text) {
            const promoWords = ['PROMO', 'DISKON', 'GRATIS', 'FREE', 'SALE', 'MURAH', 'SPESIAL'];
            promoWords.forEach(word => {
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                text = text.replace(regex, match => `<span class="highlight-promo">${match.toUpperCase()}</span>`);
            });
            
            // Highlight angka dan persentase
            text = text.replace(/(\d+%|\d+\.\d+%)/g, '<span class="highlight-number">$1</span>');
            text = text.replace(/(\d{1,3}(?:\.\d{3})*(?:,\d+)?)/g, '<span class="highlight-number">$1</span>');
            
            return text;
        }

        async function fetchRunningTexts() {
            try {
                const response = await fetch(API_URL + '?t=' + Date.now());
                const result = await response.json();
                
                if (result.success && result.activeData && result.activeData.length > 0) {
                    runningTexts = result.activeData;
                    
                    // AMBIL SETTINGS DARI GOOGLE SHEETS - INI YANG PENTING!
                    if (result.settings) {
                        scrollSpeed = parseInt(result.settings.scrollSpeed) || 25;
                        reloadInterval = parseInt(result.settings.reloadInterval) || 60;
                        
                        console.log('‚öôÔ∏è Settings loaded from Google Sheets:');
                        console.log('   - Speed: ' + scrollSpeed + ' detik');
                        console.log('   - Reload: ' + reloadInterval + ' detik');
                    }
                    
                    console.log('‚úÖ Data loaded:', runningTexts.length, 'informasi aktif');
                } else {
                    runningTexts = [{
                        text: '""',
                        daysRemaining: 999,
                        category: 'info',
                        priority: 'normal'
                    }];
                    console.log('‚ÑπÔ∏è Menggunakan data default');
                }
            } catch (error) {
                console.error('‚ùå Error loading data:', error);
                runningTexts = [{
                    text: '""',
                    daysRemaining: 999,
                    category: 'info',
                    priority: 'normal'
                }];
            }
        }

        function updateProgressBar(duration) {
            clearInterval(progressInterval);
            progressBar.style.width = '0%';
            
            const startTime = Date.now();
            const totalDuration = duration * 1000;
            
            progressInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min((elapsed / totalDuration) * 100, 100);
                progressBar.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 50);
        }

        function showNextText() {
            if (isAnimating || runningTexts.length === 0) return;
            
            if (currentTextIndex >= runningTexts.length) {
                currentTextIndex = 0;
            }

            const currentItem = runningTexts[currentTextIndex];
            let displayText = currentItem.text;
            
            const category = currentItem.category || detectCategory(displayText);
            const icon = categoryIcons[category] || categoryIcons.default;
            
            const isNew = currentItem.daysRemaining > 0 && currentItem.daysRemaining >= (currentItem.durationDays - 1);
            const newBadge = isNew ? '<span class="new-badge">NEW</span>' : '';
            
            let expiringInfo = '';
            if (currentItem.daysRemaining <= 2 && currentItem.daysRemaining > 0) {
                expiringInfo = ` <span style="color: #ff0000; font-weight: 900;">(Berakhir ${currentItem.daysRemaining} hari lagi!)</span>`;
            }
            
            const isBreaking = currentItem.priority === 'urgent';
            
            displayText = highlightText(displayText);
            
            const finalText = `
                <span class="category-icon">${icon}</span>
                ${displayText}
                ${newBadge}
                ${expiringInfo}
                <span class="category-icon">${icon}</span>
            `;
            
            marqueeText.innerHTML = finalText;
            
            if (isBreaking) {
                marqueeText.classList.add('breaking');
            } else {
                marqueeText.classList.remove('breaking');
            }
            
            // GUNAKAN KECEPATAN DARI SETTINGS
            const duration = scrollSpeed;
            
            // Reset animasi
            marqueeText.style.animation = 'none';
            marqueeText.offsetHeight; // Force reflow
            
            // Pakai animasi SMOOTH LINEAR - TIDAK NGEBUT!
            marqueeText.style.animation = `scrollSmooth ${duration}s linear forwards`;
            
            updateProgressBar(duration);
            
            isAnimating = true;
            currentTextIndex++;

            console.log(`üì∫ [${category}] "${currentItem.text.substring(0, 50)}..." | Speed: ${duration}s (linear)`);

            setTimeout(() => {
                isAnimating = false;
                // Delay 1 detik sebelum teks berikutnya
                setTimeout(showNextText, 1000);
            }, duration * 1000);
        }

        function reloadSlides() {
            const currentSrc = iframe.src;
            iframe.src = '';
            setTimeout(() => {
                iframe.src = currentSrc;
                console.log('üîÑ Slides reloaded');
            }, 100);
        }

        function updateTime() {
            const daysOfWeek = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            const monthsOfYear = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];

            const currentDate = new Date();
            const dayOfWeek = daysOfWeek[currentDate.getDay()];
            const dayOfMonth = currentDate.getDate();
            const month = monthsOfYear[currentDate.getMonth()];
            const year = currentDate.getFullYear();
            const hours = currentDate.getHours().toString().padStart(2, '0');
            const minutes = currentDate.getMinutes().toString().padStart(2, '0');
            const seconds = currentDate.getSeconds().toString().padStart(2, '0');

            timeDisplay.textContent = `${dayOfWeek}, ${dayOfMonth} ${month} ${year} | ${hours}:${minutes}:${seconds}`;
        }

        // Hide loading screen after 3 seconds
        setTimeout(() => {
            loadingScreen.style.display = "none";
            iframe.style.opacity = 1;
        }, 3000);

        // Update time every second
        setInterval(updateTime, 1000);
        updateTime();

        // Initial fetch and start animation
        fetchRunningTexts().then(() => {
            showNextText();
        });

        // Refresh data every 3 minutes
        setInterval(() => {
            fetchRunningTexts().then(() => {
                console.log('‚ôªÔ∏è Data refreshed from Google Sheets');
            });
        }, 180000);

        // Reload slides based on settings
        setInterval(reloadSlides, reloadInterval * 1000);

        console.log('üöÄ Display Tjahaja Baru - PREMIUM VERSION');
        console.log('üéØ Running Text Mode: SMOOTH LINEAR (seperti TV)');
        console.log('üì° API: ' + API_URL);
    </script>
</body>
</html>
